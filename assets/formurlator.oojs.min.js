/*! formurlator - v0.1.0 - 2018-08-08 */
!function(t){"use strict";var a={},c=a.hasOwnProperty,n=a.toString;function i(t,e,n){var i,r,o={},s=[];for(i=0,r=e.length;i<r;i++)o[e[i]]=!0;for(i=0,r=t.length;i<r;i++)!!o[t[i]]===n&&s.push(t[i]);return s}a.initClass=function(t){t.static=t.static||{}},a.inheritClass=function(t,e){var n;if(!e)throw new Error("inheritClass: Origin is not a function (actually "+e+")");if(t.prototype instanceof e)throw new Error("inheritClass: Target already inherits from origin");n=t.prototype.constructor,t.super=t.parent=e,t.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a.initClass(e),t.static=Object.create(e.static)},a.mixinClass=function(t,e){var n;if(!e)throw new Error("mixinClass: Origin is not a function (actually "+e+")");for(n in e.prototype)"constructor"!==n&&c.call(e.prototype,n)&&(t.prototype[n]=e.prototype[n]);if(a.initClass(t),e.static)for(n in e.static)c.call(e.static,n)&&(t.static[n]=e.static[n]);else a.initClass(e)},a.isSubclass=function(t,e){return t===e||t.prototype instanceof e},a.getProp=function(t){var e,n=t;for(e=1;e<arguments.length;e++){if(null==n)return;n=n[arguments[e]]}return n},a.setProp=function(t){var e,n=t;if(!(Object(t)!==t||arguments.length<2)){for(e=1;e<arguments.length-2;e++){if(void 0===n[arguments[e]]&&(n[arguments[e]]={}),Object(n[arguments[e]])!==n[arguments[e]])return;n=n[arguments[e]]}n[arguments[arguments.length-2]]=arguments[arguments.length-1]}},a.deleteProp=function(t){var e,n=t,i=[n];if(!(Object(t)!==t||arguments.length<2)){for(e=1;e<arguments.length-1;e++){if(void 0===n[arguments[e]]||Object(n[arguments[e]])!==n[arguments[e]])return;n=n[arguments[e]],i.push(n)}for(delete n[arguments[e]];1<i.length&&(n=i.pop())&&a.isPlainObject(n)&&!Object.keys(n).length;)delete i[i.length-1][arguments[i.length]]}},a.cloneObject=function(t){var e,n;for(e in n=Object.create(t.constructor.prototype),t)c.call(t,e)&&(n[e]=t[e]);return n},a.getObjectValues=function(t){var e,n;if(t!==Object(t))throw new TypeError("Called on non-object");for(e in n=[],t)c.call(t,e)&&(n[n.length]=t[e]);return n},a.binarySearch=function(t,e,n){for(var i,r,o=0,s=t.length;o<s;)if((r=e(t[i=o+s>>1]))<0)s=i;else{if(!(0<r))return i;o=i+1}return n?s:null},a.compare=function(t,e,n){var i,r,o,s;if(t===e)return!0;if(e=e||{},"number"==typeof(t=t||{}).nodeType&&"function"==typeof t.isEqualNode)return t.isEqualNode(e);for(s in t)if(c.call(t,s)&&void 0!==t[s]&&t[s]!==e[s]&&((o=typeof(i=t[s]))!=typeof(r=e[s])||("string"===o||"number"===o||"boolean"===o)&&i!==r||i===Object(i)&&!a.compare(i,r,!0)))return!1;return!!n||a.compare(e,t,!0)},a.copy=function(t,e,n){var i,r;if(n&&void 0!==(r=n(t)))return r;if(Array.isArray(t))r=new Array(t.length);else{if(t&&"function"==typeof t.clone)return e?e(t.clone()):t.clone();if(t&&"function"==typeof t.cloneNode)return e?e(t.cloneNode(!0)):t.cloneNode(!0);if(!a.isPlainObject(t))return e?e(t):t;r={}}for(i in t)r[i]=a.copy(t[i],e,n);return r},a.getHash=function(t){return JSON.stringify(t,a.getHash.keySortReplacer)},a.getHash.keySortReplacer=function(t,e){var n,i,r,o;if(e&&"function"==typeof e.getHashObject&&(e=e.getHashObject()),Array.isArray(e)||Object(e)!==e)return e;for(n={},r=0,o=(i=Object.keys(e).sort()).length;r<o;r+=1)n[i[r]]=e[i[r]];return n},a.unique=function(t){return t.reduce(function(t,e){return-1===t.indexOf(e)&&t.push(e),t},[])},a.simpleArrayUnion=function(){var t,e,n,i,r,o={},s=[];for(t=0,e=arguments.length;t<e;t++)for(i=0,r=(n=arguments[t]).length;i<r;i++)o[n[i]]||(o[n[i]]=!0,s.push(n[i]));return s},a.simpleArrayIntersection=function(t,e){return i(t,e,!0)},a.simpleArrayDifference=function(t,e){return i(t,e,!1)},a.isPlainObject=function(t){var e;return!(!t||"[object Object]"!==n.call(t))&&(!(e=Object.getPrototypeOf(t))||c.call(e,"isPrototypeOf"))},function(){function o(t,e){if("string"==typeof t){if(null==e)throw new Error('Method name "'+t+'" has no context.');if("function"!=typeof e[t])throw new Error('Property "'+t+'" is not a function')}else if("function"!=typeof t)throw new Error("Invalid callback. Function or method name expected.")}function r(t,e,n){(c.call(t.bindings,e)?t.bindings[e]:t.bindings[e]=[]).push(n)}a.EventEmitter=function(){this.bindings={}},a.initClass(a.EventEmitter),a.EventEmitter.prototype.on=function(t,e,n,i){return o(e,i),r(this,t,{method:e,args:n,context:arguments.length<4?null:i,once:!1}),this},a.EventEmitter.prototype.once=function(t,e){return o(e),r(this,t,{method:e,args:void 0,context:null,once:!0}),this},a.EventEmitter.prototype.off=function(t,e,n){var i,r;if(1===arguments.length)return delete this.bindings[t],this;if(o(e,n),!c.call(this.bindings,t)||!this.bindings[t].length)return this;for(arguments.length<3&&(n=null),i=(r=this.bindings[t]).length;i--;)r[i].method===e&&r[i].context===n&&r.splice(i,1);return 0===r.length&&delete this.bindings[t],this},a.EventEmitter.prototype.emit=function(t){var e,n,i,r,o,s=[];if(c.call(this.bindings,t)){for(r=this.bindings[t].slice(),e=1,n=arguments.length;e<n;e++)s.push(arguments[e]);for(e=0,n=r.length;e<n;e++)o="string"==typeof(i=r[e]).method?i.context[i.method]:i.method,i.once&&this.off(t,o),o.apply(i.context,i.args?i.args.concat(s):s);return!0}return!1},a.EventEmitter.prototype.connect=function(t,e){var n,i,r;for(r in e)n=e[r],Array.isArray(n)?(i=n.slice(1),n=n[0]):i=[],this.on(r,n,i,t);return this},a.EventEmitter.prototype.disconnect=function(t,e){var n,i,r,o;if(e)for(i in e)r=e[i],Array.isArray(r)&&(r=r[0]),this.off(i,r,t);else for(i in this.bindings)for(n=(o=this.bindings[i]).length;n--;)o[n]&&o[n].context===t&&this.off(i,o[n].method,t);return this}}(),function(){function r(t,e){return void 0===e||e<0||e>=t.length?t.length:e}a.EmitterList=function(){this.items=[],this.aggregateItemEvents={}},a.EmitterList.prototype.getItems=function(){return this.items.slice(0)},a.EmitterList.prototype.getItemIndex=function(t){return this.items.indexOf(t)},a.EmitterList.prototype.getItemCount=function(){return this.items.length},a.EmitterList.prototype.isEmpty=function(){return!this.items.length},a.EmitterList.prototype.aggregate=function(t){var e,n,i,r,o,s;for(o in t){if(s=t[o],Object.prototype.hasOwnProperty.call(this.aggregateItemEvents,o)){if(s)throw new Error("Duplicate item event aggregation for "+o);for(e=0;e<this.items.length;e++)(n=this.items[e]).connect&&n.disconnect&&((r={})[o]=["emit",this.aggregateItemEvents[o],n],n.disconnect(this,r));delete this.aggregateItemEvents[o]}if(s)for(this.aggregateItemEvents[o]=s,e=0;e<this.items.length;e++)(n=this.items[e]).connect&&n.disconnect&&((i={})[o]=["emit",s,n],n.connect(this,i))}},a.EmitterList.prototype.addItems=function(t,e){var n,i;if(Array.isArray(t)||(t=[t]),0===t.length)return this;for(e=r(this.items,e),n=0;n<t.length;n++)-1!==(i=this.items.indexOf(t[n]))?(e=this.moveItem(t[n],e),this.emit("move",t[n],e,i)):(e=this.insertItem(t[n],e),this.emit("add",t[n],e)),e++;return this},a.EmitterList.prototype.moveItem=function(t,e){var n=this.items.indexOf(t);if(-1===n)throw new Error("Item cannot be moved, because it is not in the list.");return e=r(this.items,e),this.items.splice(n,1),n<e&&e--,this.items.splice(e,0,t),e},a.EmitterList.prototype.insertItem=function(t,e){var n,i;if(t.connect&&t.disconnect){for(i in n={},this.aggregateItemEvents)n[i]=["emit",this.aggregateItemEvents[i],t];t.connect(this,n)}return e=r(this.items,e),this.items.splice(e,0,t),e},a.EmitterList.prototype.removeItems=function(t){var e,n,i;if(Array.isArray(t)||(t=[t]),0===t.length)return this;for(e=0;e<t.length;e++)n=t[e],-1!==(i=this.items.indexOf(n))&&(n.connect&&n.disconnect&&n.disconnect(this),this.items.splice(i,1),this.emit("remove",n,i));return this},a.EmitterList.prototype.clearItems=function(){var t,e,n=this.items.splice(0,this.items.length);for(t=0;t<n.length;t++)(e=n[t]).connect&&e.disconnect&&e.disconnect(this);return this.emit("clear"),this}}(),a.SortedEmitterList=function(t){a.EmitterList.call(this),this.sortingCallback=t,this.aggregate({sortChange:"itemSortChange"}),this.connect(this,{itemSortChange:"onItemSortChange"})},a.mixinClass(a.SortedEmitterList,a.EmitterList),a.SortedEmitterList.prototype.onItemSortChange=function(t){this.removeItems(t),this.addItems(t)},a.SortedEmitterList.prototype.setSortingCallback=function(t){var e=this.getItems();this.sortingCallback=t,this.clearItems(),this.addItems(e)},a.SortedEmitterList.prototype.addItems=function(t){var e,n,i;if(Array.isArray(t)||(t=[t]),0===t.length)return this;for(n=0;n<t.length;n++)(i=this.findInsertionIndex(t[n]))<=this.items.length&&this.items[i]&&0===this.sortingCallback(this.items[i],t[n])&&this.removeItems(this.items[i]),e=this.insertItem(t[n],i),this.emit("add",t[n],e);return this},a.SortedEmitterList.prototype.findInsertionIndex=function(e){var n=this;return a.binarySearch(this.items,function(t){return n.sortingCallback(e,t)},!0)},a.Registry=function(){a.EventEmitter.call(this),this.registry={}},a.mixinClass(a.Registry,a.EventEmitter),a.Registry.prototype.register=function(t,e){var n,i;if("string"==typeof t)this.registry[t]=e,this.emit("register",t,e);else{if(!Array.isArray(t))throw new Error("Name must be a string or array, cannot be a "+typeof t);for(n=0,i=t.length;n<i;n++)this.register(t[n],e)}},a.Registry.prototype.unregister=function(t){var e,n,i;if("string"==typeof t)void 0!==(i=this.lookup(t))&&(delete this.registry[t],this.emit("unregister",t,i));else{if(!Array.isArray(t))throw new Error("Name must be a string or array, cannot be a "+typeof t);for(e=0,n=t.length;e<n;e++)this.unregister(t[e])}},a.Registry.prototype.lookup=function(t){if(c.call(this.registry,t))return this.registry[t]},a.Factory=function(){a.Factory.super.call(this)},a.inheritClass(a.Factory,a.Registry),a.Factory.prototype.register=function(t){var e;if("function"!=typeof t)throw new Error("constructor must be a function, cannot be a "+typeof t);if("string"!=typeof(e=t.static&&t.static.name)||""===e)throw new Error("Name must be a string and must not be empty");a.Factory.super.prototype.register.call(this,e,t)},a.Factory.prototype.unregister=function(t){var e;if("function"!=typeof t)throw new Error("constructor must be a function, cannot be a "+typeof t);if("string"!=typeof(e=t.static&&t.static.name)||""===e)throw new Error("Name must be a string and must not be empty");a.Factory.super.prototype.unregister.call(this,e)},a.Factory.prototype.create=function(t){var e,n,i=[],r=this.lookup(t);if(!r)throw new Error("No class registered by that name: "+t);for(n=1;n<arguments.length;n++)i.push(arguments[n]);return e=Object.create(r.prototype),r.apply(e,i),e},"undefined"!=typeof module&&module.exports?module.exports=a:t.OO=a}(this),window.formurlator=function(){"use strict";var fr={Element:function(e,t,n){var i,r,o=this;if(!(e&&(e instanceof Element||Array.isArray(e)||e instanceof NodeList)))throw new Error('Element provided for "'+t+'" is not a valid DOM element or array of DOM elements.');if(OO.EventEmitter.call(this),OO.EmitterList.call(this),this.name=t,this.element=e,this.active=!1,this.cachedValue=null,this.options=[],this.optionValues=[],this.onDomChangeFunction=this.onDOMChange.bind(o),Array.isArray(e)||e instanceof NodeList){if((this.element=e)instanceof NodeList)for(this.element=[],i=0;i<e.length;i++)this.element.push(e[i]);if(this.element=this.element.filter(function(t){return t.type===e[0].type}),"checkbox"!==this.element[0].type&&"radio"!==this.element[0].type)throw new Error("An array of elements must be of checkbox or radio type.");this.type=this.element[0].type+"-group"}else this.type=this.element.type;if("select-one"===this.getType()||"select-multiple"===this.getType())for(r=this.element.options,i=0;i<r.length;i++)this.options[i]=this.element.options[i],this.optionValues[i]=this.element.options[i].value;else"radio-group"!==this.getType()&&"checkbox-group"!==this.getType()||this.element.forEach(function(t){o.options.push(t),o.optionValues.push(t.value)});"radio-group"===this.getType()||"checkbox-group"===this.getType()?this.element.forEach(function(t){t.addEventListener("change",o.onDomChangeFunction)}):this.element.addEventListener("change",this.onDomChangeFunction),this.setValue(void 0!==n?n:this.getValue())}};OO.initClass(fr.Element),OO.mixinClass(fr.Element,OO.EventEmitter),OO.mixinClass(fr.Element,OO.EmitterList),fr.Element.prototype.onDOMChange=function(){this.setValue(this.getValue())},fr.Element.prototype.getDetails=function(){var t={type:this.getType()};switch(this.getType()){case"number":t.range={min:""!==this.element.min?Number(this.element.min):null,max:""!==this.element.max?Number(this.element.max):null};break;case"radio-group":case"checkbox-group":case"select-one":case"select-multiple":t.options=this.getOptionValues(),t.separator=","}return t},fr.Element.prototype.setValue=function(t){var e,n;if(t=this.normalizeValue(t),!this.compareValues(this.cachedValue,t)){switch(this.getType()){case"checkbox-group":for(e=0;e<this.element.length;e++)this.element[e].checked=-1<t.indexOf(this.element[e].value);break;case"select-multiple":for(n=this.element.options,e=0;e<n.length;e++)n[e].selected=-1<t.indexOf(n[e].value);break;case"checkbox":this.element.checked=t;break;case"radio-group":for(e=0;e<this.element.length;e++)this.element[e].checked=this.element[e].value===t;break;default:this.element.value=t}this.cachedValue=t,this.emit("update",t)}},fr.Element.prototype.getValue=function(){var e,t;switch(this.getType()){case"number":return Number(this.element.value);case"select-multiple":return e=[],this.options.forEach(function(t){t.selected&&e.push(t.value)}),e;case"checkbox":return this.element.checked;case"checkbox-group":return this.element.filter(function(t){return t.checked}).map(function(t){return t.value});case"radio-group":return(t=this.element.filter(function(t){return t.checked})[0])?t.value:this.optionValues[0];case"text":case"select-one":default:return this.element.value}},fr.Element.prototype.normalizeValue=function(t){var i=this;switch(this.getType()){case"number":return this.element.min||this.element.max?isNaN(t)?Number(this.element.min):this.element.min&&Number(t)<this.element.min?Number(this.element.min):this.element.max&&Number(t)>this.element.max?Number(this.element.max):Number(t):isNaN(t)?0:Number(t);case"radio-group":case"select-one":return-1<this.getOptionValues().indexOf(t)?t:this.options[0].value;case"checkbox":return isNaN(t)?!!t:!!Number(t);case"checkbox-group":case"select-multiple":return t=(t=Array.isArray(t)?t:[t]).filter(function(t,e,n){return n.indexOf(t)===e&&-1<i.getOptionValues().indexOf(t)});default:return String(t)}},fr.Element.prototype.compareValues=function(t,e){var n,i,r;if(!Array.isArray(t)||!Array.isArray(e))return t===e;if(t.length!==e.length)return!1;for(i=e.slice(0);i.length;)for(n=0;n<t.length;n++){if(-1===(r=i.indexOf(t[n])))return!1;i.splice(r,1)}return!0},fr.Element.prototype.toggle=function(t){t=void 0===t?!this.active:!!t,this.active!==t&&(this.active=t,this.emit("active",this.active))},fr.Element.prototype.isActive=function(){return this.active},fr.Element.prototype.getType=function(){return this.type},fr.Element.prototype.getName=function(){return this.name},fr.Element.prototype.getOptionValues=function(){return this.optionValues},fr.Element.prototype.destroy=function(){var e=this;"radio-group"===this.getType()||"checkbox-group"===this.getType()?this.element.forEach(function(t){t.removeEventListener("change",e.onDomChangeFunction)}):this.element.removeEventListener("change",this.onDomChangeFunction)},fr.DOMManager=function(t){t=t||{},OO.EventEmitter.call(this),OO.EmitterList.call(this),this.active=!1,this.initiallyActive=!!t.active,this.toggle(!!t.active),this.aggregate({update:"elementUpdate",active:"elementActive"}),this.connect(this,{elementUpdate:"onElementUpdate",elementActive:"onElementActive"})},OO.initClass(fr.DOMManager),OO.mixinClass(fr.DOMManager,OO.EventEmitter),OO.mixinClass(fr.DOMManager,OO.EmitterList),fr.DOMManager.prototype.onElementUpdate=function(t,e){t.isActive()&&this.emit("update",t.getName(),e)},fr.DOMManager.prototype.onElementActive=function(t,e){this.emit("active",t.getName(),e)},fr.DOMManager.prototype.getState=function(){var e={};return this.getActiveItems().forEach(function(t){e[t.getName()]=t.getValue()}),e},fr.DOMManager.prototype.getDetails=function(){var e={};return this.getActiveItems().forEach(function(t){e[t.getName()]=t.getDetails()}),e},fr.DOMManager.prototype.setValues=function(n){var i=this;Object.keys(n).forEach(function(t){var e=i.getElementByName(t);e&&e.setValue(n[t])})},fr.DOMManager.prototype.getValue=function(t){var e=this.getElementByName(t);return e?e.getValue():null},fr.DOMManager.prototype.stop=function(t){this.toggle(!1,t)},fr.DOMManager.prototype.start=function(t){this.toggle(!0,t)},fr.DOMManager.prototype.toggle=function(e,t){var n;t?(n=this.getElementByName(t))&&n.toggle(!!e):this.getItems().forEach(function(t){t.toggle(!!e)}),this.active=this.getItems().length?!!this.getActiveItems().length:!!this.initiallyActive},fr.DOMManager.prototype.getAllNames=function(){return this.getItems().map(function(t){return t.getName()})},fr.DOMManager.prototype.addItems=function(t){OO.EmitterList.prototype.addItems.call(this,t),this.isActive()&&t.forEach(function(t){t.toggle(!0)})},fr.DOMManager.prototype.isActive=function(t){var e;return t?(e=this.getElementByName(t))&&e.isActive():this.active},fr.DOMManager.prototype.getElementByName=function(e){return this.getItems().filter(function(t){return t.getName()===e})[0]||null},fr.DOMManager.prototype.getActiveItems=function(){return this.getItems().filter(function(t){return t.isActive()})},fr.DOMManager.prototype.destroy=function(){this.disconnect(this),this.getItems().forEach(function(t){t.destroy()})},fr.Controller=function(t){t=t||{},this.manager=new fr.DOMManager({active:void 0===t.active||t.active}),this.manager.connect(this,{update:"onManagerChange",active:"onManagerChange"})},OO.initClass(fr.Controller),fr.Controller.prototype.onManagerChange=function(){var t=this.getNewURLQuery();this.updateURL(t)},fr.Controller.prototype.updateURL=function(t){fr.TESTING||window.history.replaceState(window.document.title,{formurlator:"formurlator"},"?"+this.getQueryToString(t))},fr.Controller.prototype.getQueryToString=function(e){var n=[];return Object.keys(e).forEach(function(t){n.push([encodeURIComponent(t),encodeURIComponent(e[t])].join("="))}),n.join("&")},fr.Controller.prototype.getNewURLQuery=function(t){var e,n,i=this.getURLQueryFromElements(),r=this.parseQueryString(t);return e=r,n=i,Object.keys(n).forEach(function(t){e[t]=n[t]}),e},fr.Controller.prototype.getURLQueryFromElements=function(){var e=this,n={},i=this.manager.getState(),r=this.manager.getDetails();return Object.keys(i).forEach(function(t){n[t]=e.convertElementValueToURLParam(i[t],r[t])}),n},fr.Controller.prototype.convertElementValueToURLParam=function(t,e){switch(e.type){case"checkbox":return String(Number(t));case"checkbox-group":case"select-multiple":return t.join(e.separator);default:return String(t)}},fr.Controller.prototype.parseQueryString=function(t){var n={};return t=void 0!==t?t:window.location.search,0===(t=decodeURIComponent(t)).indexOf("?")&&(t=t.substring(1)),t.split("&").forEach(function(t){var e=t.split("=");e[0]&&(n[e[0]]=e[1]||"")}),n},fr.Controller.prototype.add=function(i){var r,o,s,a=this;if(Array.isArray(i)||"string"==typeof i)throw new Error("When adding an element, the definition must be an object. Please see the documentation for help.");r=this.manager.getAllNames(),Object.keys(i).forEach(function(t){var e=i[t],n=e;-1<r.indexOf(t)||(Array.isArray(e)&&(n=e.filter(function(t){return t instanceof Element})),o=a.parseQueryString(),s=o[t],a.manager.addItems([new fr.Element(n,t,s)]))})},fr.Controller.prototype.start=function(t){this.manager.start(t)},fr.Controller.prototype.stop=function(t){this.manager.stop(t)},fr.Controller.prototype.destroy=function(){this.manager.destroy(),this.manager.disconnect(this)};var e=new fr.Controller;return{add:e.add.bind(e),stop:e.stop.bind(e),start:e.start.bind(e),reload:function(t){e&&e.destroy(),e=new fr.Controller(t)}}}();
//# sourceMappingURL=formurlator.oojs.min.js.map
